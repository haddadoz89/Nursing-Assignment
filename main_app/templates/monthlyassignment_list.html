{% extends 'base.html' %}

{% block title %}Manage Monthly Assignments{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Manage Monthly Assignments</h2>
    <a href="{% url 'main_app:monthly_assignment_create' %}" class="btn btn-primary">+ Add New</a>
</div>
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Monthly Assignments for {{ month_name }} {{ year }}</h2>
    <div> <a href="{% url 'main_app:monthly_assignment_bulk_assign' year month %}" class="btn btn-success me-2">Bulk
            Assign this Month</a>
    </div>
</div>
<div class="table-responsive">
    <table class="table table-striped table-bordered">
        <thead class="table-light">
            <tr>
                <th>Group</th>
                <th>Task</th>
                <th>Staff Member</th>
                <th>Committee</th>
                <th>Period</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% regroup assignments by group as assignments_by_group %}
            {% for group in assignments_by_group %}
            {% for assignment in group.list %}
            <tr>
                {% if forloop.first %}
                {# Display the group name, or "N/A" if no group is assigned #}
                <td rowspan="{{ group.list|length }}" class="align-middle fw-bold">{{ group.grouper.name|default:"N/A"
                    }}</td>
                {% endif %}
                <td>{{ assignment.task.name }}</td>
                <td>{{ assignment.staff.get_full_name }}</td>
                {# Display the committee name, or a dash if none is assigned #}
                <td>{{ assignment.committee.name|default:"-" }}</td>
                <td>{{ assignment.start_date|date:"M j" }} - {{ assignment.end_date|date:"M j, Y" }}</td>
                <td>
                    <a href="{% url 'main_app:monthly_assignment_edit' assignment.pk %}"
                        class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'main_app:monthly_assignment_delete' assignment.pk %}"
                        class="btn btn-sm btn-danger">Delete</a>
                </td>
            </tr>
            {% endfor %}
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No monthly assignments found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}