{% extends 'base.html' %}

{% block title %}Daily Schedule - {{ view_date|date:"F j, Y" }}{% endblock %}

{% block content %}
<style>
    @page {
        size: A4 landscape;
        margin: 1cm;
    }
    
    /* Hide navigation, footer, and other UI elements for PDF */
    nav, footer, .container {
        display: none !important;
    }
    
    /* Override container hiding for the main content */
    .pdf-content {
        display: block !important;
        margin: 0 !important;
        padding: 0 !important;
        max-width: none !important;
    }
    
    body {
        font-family: Arial, sans-serif;
        font-size: 12px;
        margin: 0;
        padding: 0;
    }
    
    .page-header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #333;
        padding-bottom: 10px;
    }
    
    .shift-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }
    
    .date-title {
        font-size: 14px;
        color: #666;
    }
    
    .staff-section {
        margin-bottom: 25px;
    }
    
    .section-header {
        background-color: #f5f5f5;
        padding: 8px 10px;
        font-weight: bold;
        font-size: 14px;
        border: 1px solid #ddd;
        margin-bottom: 0;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 0;
    }
    
    .table th, .table td {
        border: 1px solid #ddd;
        padding: 6px 8px;
        text-align: left;
        vertical-align: top;
        font-size: 11px;
    }
    
    .table th {
        background-color: #e9ecef;
        font-weight: bold;
        text-align: center;
    }
    
    .table td.staff-name {
        font-weight: bold;
        min-width: 120px;
    }
    
    .table td.shift-type {
        text-align: center;
        min-width: 80px;
    }
    
    .no-assignments {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 20px;
    }
    
    /* Page break after each shift */
    .shift-page {
        page-break-after: always;
    }
    
    /* Don't break the last page */
    .shift-page:last-child {
        page-break-after: auto;
    }
    
    .assignments-cell {
        max-width: 120px;
        word-wrap: break-word;
    }
    
    .assignment-item {
        display: block;
        margin-bottom: 2px;
    }
</style>

<div class="pdf-content">
    {% for shift_name, shift_data in shifts_by_type.items %}
    <div class="shift-page">
        <!-- Page Header -->
        <div class="page-header">
            <div class="shift-title">{{ shift_name }} Shift</div>
            <div class="date-title">{{ view_date|date:"l, F j, Y" }}</div>
        </div>

        <!-- Staff Nurses Section -->
        {% if shift_data.nurse_shifts %}
        <div class="staff-section">
            <div class="section-header">Staff Nurses & Managers</div>
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 15%;">Staff Name</th>
                        <th style="width: 10%;">Shift</th>
                        <th style="width: 18%;">Main Assignment</th>
                        <th style="width: 18%;">Sub-Assignment</th>
                        <th style="width: 18%;">Clinic</th>
                        <th style="width: 18%;">Emergency Role</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shift in shift_data.nurse_shifts %}
                    <tr>
                        <td class="staff-name">{{ shift.staff.get_full_name }}</td>
                        <td class="shift-type">{{ shift.shift_type.name }}</td>
                        <td class="assignments-cell">
                            {% for item in shift.assignments.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                        <td class="assignments-cell">
                            {% for item in shift.sub_assignments.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                        <td class="assignments-cell">
                            {% for item in shift.clinics.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                        <td class="assignments-cell">
                            {% for item in shift.emergency_roles.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- MAS Section -->
        {% if shift_data.mas_shifts %}
        <div class="staff-section">
            <div class="section-header">Medical Ancillary Services (MAS)</div>
            <table class="table">
                <thead>
                    <tr>
                        <th style="width: 20%;">Staff Name</th>
                        <th style="width: 15%;">Shift</th>
                        <th style="width: 25%;">Assignment</th>
                        <th style="width: 25%;">Sub-Assignment</th>
                    </tr>
                </thead>
                <tbody>
                    {% for shift in shift_data.mas_shifts %}
                    <tr>
                        <td class="staff-name">{{ shift.staff.get_full_name }}</td>
                        <td class="shift-type">{{ shift.shift_type.name }}</td>
                        <td class="assignments-cell">
                            {% for item in shift.assignments.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                        <td class="assignments-cell">
                            {% for item in shift.sub_assignments.all %}
                                <span class="assignment-item">{{ item.name }}</span>
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- No staff assigned message -->
        {% if not shift_data.nurse_shifts and not shift_data.mas_shifts %}
        <div class="no-assignments">
            No staff assigned for {{ shift_name }} shift on this day.
        </div>
        {% endif %}
    </div>
    {% empty %}
    <div class="page-header">
        <div class="shift-title">Daily Schedule</div>
        <div class="date-title">{{ view_date|date:"l, F j, Y" }}</div>
    </div>
    <div class="no-assignments">
        No staff assigned for this day.
    </div>
    {% endfor %}
</div>
{% endblock %}