{% extends 'base.html' %}
{% load roster_extras %}

{% block title %}Bulk Assign Monthly Tasks - {{ month_name }} {{ year }}{% endblock %}

{% block content %}
    <h2>Bulk Assign Monthly Tasks for {{ month_name }} {{ year }}</h2>
    <p>Assign a group, committee, and one or more tasks to each staff member for the month.</p>

    <form method="post">
        {% csrf_token %}
        <div class="table-responsive">
            <table class="table table-bordered table-sm">
                <thead class="table-light">
                    <tr>
                        <th>Staff Member</th>
                        <th>Group</th>
                        <th>Committee(s)</th>
                        <th>Monthly Task(s)</th>
                    </tr>
                </thead>
                
                {% for group in groups %}
                <tbody>
                    <tr class="table-secondary">
                        <td colspan="4" class="fw-bold">{{ group.name }}</td>
                    </tr>
                    {% for staff in group.staff_members.all %}
                    <tr>
                        <td class="fw-bold">{{ staff.get_full_name }}</td>
                        <input type="hidden" name="group_{{ staff.id }}" value="{{ group.id }}">
                        
                        {% with staff_map=assignment_map|get_item:staff.id %}
                        <td>
                            <select name="committees_{{ staff.id }}" class="form-select" multiple size="3">
                                {% for committee in all_committees %}
                                    <option value="{{ committee.id }}" {% if committee.id in staff_map.committees %}selected{% endif %}>
                                        {{ committee.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        <td>
                            <select name="tasks_{{ staff.id }}" class="form-select" multiple size="5">
                                {% for task in all_tasks %}
                                    <option value="{{ task.id }}" {% if task.id in staff_map.tasks %}selected{% endif %}>
                                        {{ task.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        {% endwith %}
                    </tr>
                    {% endfor %}
                </tbody>
                {% endfor %}
            </table>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Save All Assignments for {{ month_name }}</button>
        <a href="{% url 'main_app:monthly_assignment_display' view_date.year view_date.month %}" class="btn btn-secondary mt-3">Cancel</a>
    </form>
{% endblock %}